
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Kidney Health Tools</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
            padding: 80px 0;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 70%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            animation: heroGlow 6s ease-in-out infinite alternate;
        }

        @keyframes heroGlow {
            0% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .section-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .hero h2 {
            font-size: 3rem;
            margin-bottom: 20px;
            font-weight: 800;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
            opacity: 0.95;
        }

        /* Tools Grid */
        .tools-section {
            padding: 80px 0;
            background: transparent;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin: 60px 0;
        }

        /* Tool Cards */
        .tool-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(59, 130, 246, 0.1);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .tool-card:hover::before {
            transform: scaleX(1);
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }

        .tool-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .tool-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
            color: white;
        }

        .tool-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #111827;
        }

        .tool-description {
            color: #6b7280;
            margin-bottom: 25px;
            font-size: 0.95rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #ffffff;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            background: #ffffff;
            cursor: pointer;
        }

        .btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Results */
        .result-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #bae6fd;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 800;
            color: #1e40af;
            margin-bottom: 10px;
        }

        .result-interpretation {
            font-size: 1rem;
            color: #1e3a8a;
            font-weight: 500;
        }

        .result-stage {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        /* Stage Colors */
        .stage-1 { background: #dcfce7; color: #166534; }
        .stage-2 { background: #fef3c7; color: #92400e; }
        .stage-3a, .stage-3b { background: #fed7aa; color: #9a3412; }
        .stage-4 { background: #fecaca; color: #991b1b; }
        .stage-5 { background: #fca5a5; color: #7f1d1d; }

        /* Progress Tracker */
        .progress-tracker {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .progress-item:last-child {
            border-bottom: none;
        }

        /* Interactive Elements */
        .slider-container {
            margin: 20px 0;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            outline: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
        }

        /* Disclaimer */
        .disclaimer {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
            border-radius: 12px;
            padding: 25px;
            margin: 40px 0;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.1);
        }

        .disclaimer h4 {
            color: #92400e;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .disclaimer p {
            color: #78350f;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <main>
        <!-- Enhanced Hero Section -->
        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <div class="section-icon">üßÆ</div>
                    <h2>Advanced Kidney Health Tools</h2>
                    <p>State-of-the-art calculators, interactive visualizations, and AI-powered insights to help you understand and monitor your kidney health with precision.</p>
                </div>
            </div>
        </section>

        <!-- Tools Section -->
        <section class="tools-section">
            <div class="container">
                <div class="tools-grid">
                    
                    <!-- Enhanced eGFR Calculator -->
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">ü©∫</div>
                            <div>
                                <div class="tool-title">Advanced eGFR Calculator</div>
                                <div class="tool-description">Calculate kidney function with CKD-EPI equation and stage visualization</div>
                            </div>
                        </div>
                        
                        <form id="egfr-form">
                            <div class="form-group">
                                <label class="form-label">Age (years)</label>
                                <input type="number" id="age" class="form-input" min="18" max="120" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Gender</label>
                                <select id="gender" class="form-select" required>
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Race</label>
                                <select id="race" class="form-select" required>
                                    <option value="">Select Race</option>
                                    <option value="black">Black/African American</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Serum Creatinine (mg/dL)</label>
                                <input type="number" id="creatinine" class="form-input" step="0.1" min="0.1" max="20" required>
                            </div>
                            
                            <button type="submit" class="btn">Calculate eGFR</button>
                        </form>
                        
                        <div id="egfr-result" style="display: none;"></div>
                        <div id="egfr-chart" class="chart-container" style="display: none;">
                            <canvas id="egfrChart"></canvas>
                        </div>
                    </div>

                    <!-- Blood Pressure Risk Calculator -->
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">‚ù§Ô∏è</div>
                            <div>
                                <div class="tool-title">BP & Kidney Risk Calculator</div>
                                <div class="tool-description">Assess cardiovascular and kidney disease risk based on blood pressure</div>
                            </div>
                        </div>
                        
                        <form id="bp-form">
                            <div class="form-group">
                                <label class="form-label">Systolic BP (mmHg)</label>
                                <input type="number" id="systolic" class="form-input" min="70" max="250" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Diastolic BP (mmHg)</label>
                                <input type="number" id="diastolic" class="form-input" min="40" max="150" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Age</label>
                                <input type="number" id="bp-age" class="form-input" min="18" max="120" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Do you have diabetes?</label>
                                <select id="diabetes" class="form-select" required>
                                    <option value="">Select</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn">Assess Risk</button>
                        </form>
                        
                        <div id="bp-result" style="display: none;"></div>
                    </div>

                    <!-- Protein Intake Calculator -->
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon" style="background: linear-gradient(135deg, #22c55e, #16a34a);">ü•©</div>
                            <div>
                                <div class="tool-title">Protein Intake Calculator</div>
                                <div class="tool-description">Calculate optimal protein intake based on CKD stage</div>
                            </div>
                        </div>
                        
                        <form id="protein-form">
                            <div class="form-group">
                                <label class="form-label">Weight (kg)</label>
                                <input type="number" id="weight" class="form-input" min="30" max="300" step="0.1" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">CKD Stage</label>
                                <select id="ckd-stage" class="form-select" required>
                                    <option value="">Select CKD Stage</option>
                                    <option value="1">Stage 1 (eGFR ‚â•90)</option>
                                    <option value="2">Stage 2 (eGFR 60-89)</option>
                                    <option value="3a">Stage 3a (eGFR 45-59)</option>
                                    <option value="3b">Stage 3b (eGFR 30-44)</option>
                                    <option value="4">Stage 4 (eGFR 15-29)</option>
                                    <option value="5">Stage 5 (eGFR <15)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Activity Level</label>
                                <select id="activity" class="form-select" required>
                                    <option value="">Select Activity Level</option>
                                    <option value="sedentary">Sedentary</option>
                                    <option value="light">Light Activity</option>
                                    <option value="moderate">Moderate Activity</option>
                                    <option value="high">High Activity</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn">Calculate Protein Needs</button>
                        </form>
                        
                        <div id="protein-result" style="display: none;"></div>
                    </div>

                    <!-- Fluid Balance Calculator -->
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">üíß</div>
                            <div>
                                <div class="tool-title">Fluid Balance Calculator</div>
                                <div class="tool-description">Calculate optimal daily fluid intake for kidney patients</div>
                            </div>
                        </div>
                        
                        <form id="fluid-form">
                            <div class="form-group">
                                <label class="form-label">24-hour Urine Output (mL)</label>
                                <input type="number" id="urine-output" class="form-input" min="0" max="5000" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Weight (kg)</label>
                                <input type="number" id="fluid-weight" class="form-input" min="30" max="200" step="0.1" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Are you on dialysis?</label>
                                <select id="dialysis" class="form-select" required>
                                    <option value="">Select</option>
                                    <option value="no">No</option>
                                    <option value="hd">Hemodialysis</option>
                                    <option value="pd">Peritoneal Dialysis</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Climate/Activity</label>
                                <select id="climate" class="form-select" required>
                                    <option value="">Select</option>
                                    <option value="normal">Normal conditions</option>
                                    <option value="hot">Hot climate/High activity</option>
                                    <option value="cold">Cold climate/Low activity</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn">Calculate Fluid Needs</button>
                        </form>
                        
                        <div id="fluid-result" style="display: none;"></div>
                    </div>

                    <!-- Medication Dosing Calculator -->
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üíä</div>
                            <div>
                                <div class="tool-title">Medication Dosing Calculator</div>
                                <div class="tool-description">Calculate adjusted medication doses based on kidney function</div>
                            </div>
                        </div>
                        
                        <form id="med-form">
                            <div class="form-group">
                                <label class="form-label">eGFR (mL/min/1.73m¬≤)</label>
                                <input type="number" id="med-egfr" class="form-input" min="5" max="150" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Medication</label>
                                <select id="medication" class="form-select" required>
                                    <option value="">Select Medication</option>
                                    <option value="metformin">Metformin</option>
                                    <option value="acei">ACE Inhibitors</option>
                                    <option value="allopurinol">Allopurinol</option>
                                    <option value="gabapentin">Gabapentin</option>
                                    <option value="atenolol">Atenolol</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Standard Dose (mg)</label>
                                <input type="number" id="standard-dose" class="form-input" min="1" max="2000" required>
                            </div>
                            
                            <button type="submit" class="btn">Calculate Adjusted Dose</button>
                        </form>
                        
                        <div id="med-result" style="display: none;"></div>
                    </div>

                    <!-- Interactive Health Tracker -->
                    <div class="tool-card" style="grid-column: 1 / -1;">
                        <div class="tool-header">
                            <div class="tool-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">üìä</div>
                            <div>
                                <div class="tool-title">Interactive Health Progress Tracker</div>
                                <div class="tool-description">Track and visualize your kidney health metrics over time</div>
                            </div>
                        </div>
                        
                        <div id="health-tracker">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <label class="form-label">Track Metric</label>
                                    <select id="track-metric" class="form-select">
                                        <option value="egfr">eGFR</option>
                                        <option value="creatinine">Creatinine</option>
                                        <option value="blood-pressure">Blood Pressure</option>
                                        <option value="weight">Weight</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label">Value</label>
                                    <input type="number" id="track-value" class="form-input" step="0.1">
                                </div>
                            </div>
                            
                            <button onclick="addDataPoint()" class="btn" style="width: auto; margin-right: 10px;">Add Data Point</button>
                            <button onclick="clearData()" class="btn" style="width: auto; background: #ef4444;">Clear Data</button>
                            
                            <div class="chart-container">
                                <canvas id="progressChart"></canvas>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Enhanced Disclaimer -->
                <div class="disclaimer">
                    <h4>‚ö†Ô∏è Important Medical Disclaimer</h4>
                    <p>All calculators and tools on this page are designed for educational and informational purposes only. They are not intended to replace professional medical advice, diagnosis, or treatment. Results should always be interpreted by a qualified nephrologist or healthcare provider. Never make treatment decisions based solely on these calculations. Always consult with your healthcare team for personalized medical guidance and interpretation of your results.</p>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Enhanced eGFR Calculator with CKD-EPI equation
        document.getElementById('egfr-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const age = parseFloat(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const race = document.getElementById('race').value;
            const creatinine = parseFloat(document.getElementById('creatinine').value);
            
            // CKD-EPI equation
            let egfr;
            const kappa = gender === 'female' ? 0.7 : 0.9;
            const alpha = gender === 'female' ? -0.329 : -0.411;
            const genderMultiplier = gender === 'female' ? 1.018 : 1;
            const raceMultiplier = race === 'black' ? 1.159 : 1;
            
            const creatRatio = creatinine / kappa;
            const minValue = Math.min(creatRatio, 1);
            const maxValue = Math.max(creatRatio, 1);
            
            egfr = 141 * Math.pow(minValue, alpha) * Math.pow(maxValue, -1.209) * 
                   Math.pow(0.993, age) * genderMultiplier * raceMultiplier;
            
            displayEGFRResult(egfr, creatinine);
            createEGFRChart(egfr);
        });

        function displayEGFRResult(egfr, creatinine) {
            const resultDiv = document.getElementById('egfr-result');
            let stage, stageClass, interpretation;
            
            if (egfr >= 90) {
                stage = "Stage 1";
                stageClass = "stage-1";
                interpretation = "Normal or high kidney function";
            } else if (egfr >= 60) {
                stage = "Stage 2";
                stageClass = "stage-2";
                interpretation = "Mild decrease in kidney function";
            } else if (egfr >= 45) {
                stage = "Stage 3a";
                stageClass = "stage-3a";
                interpretation = "Moderate decrease in kidney function";
            } else if (egfr >= 30) {
                stage = "Stage 3b";
                stageClass = "stage-3b";
                interpretation = "Moderate to severe decrease";
            } else if (egfr >= 15) {
                stage = "Stage 4";
                stageClass = "stage-4";
                interpretation = "Severe decrease in kidney function";
            } else {
                stage = "Stage 5";
                stageClass = "stage-5";
                interpretation = "Kidney failure";
            }
            
            resultDiv.innerHTML = `
                <div class="result-card">
                    <div class="result-value">${egfr.toFixed(1)} mL/min/1.73m¬≤</div>
                    <div class="result-interpretation">${interpretation}</div>
                    <div class="result-stage ${stageClass}">${stage}</div>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: #6b7280;">
                        Creatinine: ${creatinine} mg/dL
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        }

        function createEGFRChart(currentEGFR) {
            const ctx = document.getElementById('egfrChart').getContext('2d');
            document.getElementById('egfr-chart').style.display = 'block';
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Stage 1', 'Stage 2', 'Stage 3a', 'Stage 3b', 'Stage 4', 'Stage 5'],
                    datasets: [{
                        label: 'eGFR Range',
                        data: [90, 60, 45, 30, 15, 0],
                        backgroundColor: [
                            currentEGFR >= 90 ? '#22c55e' : '#e5e7eb',
                            currentEGFR >= 60 && currentEGFR < 90 ? '#f59e0b' : '#e5e7eb',
                            currentEGFR >= 45 && currentEGFR < 60 ? '#f97316' : '#e5e7eb',
                            currentEGFR >= 30 && currentEGFR < 45 ? '#ef4444' : '#e5e7eb',
                            currentEGFR >= 15 && currentEGFR < 30 ? '#dc2626' : '#e5e7eb',
                            currentEGFR < 15 ? '#991b1b' : '#e5e7eb'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Your eGFR: ${currentEGFR.toFixed(1)} mL/min/1.73m¬≤`
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // Blood Pressure Risk Calculator
        document.getElementById('bp-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const systolic = parseInt(document.getElementById('systolic').value);
            const diastolic = parseInt(document.getElementById('diastolic').value);
            const age = parseInt(document.getElementById('bp-age').value);
            const hasDiabetes = document.getElementById('diabetes').value === 'yes';
            
            let category, risk, recommendations;
            
            if (systolic < 120 && diastolic < 80) {
                category = "Normal";
                risk = "Low";
                recommendations = "Maintain healthy lifestyle";
            } else if (systolic < 130 && diastolic < 80) {
                category = "Elevated";
                risk = "Moderate";
                recommendations = "Lifestyle modifications recommended";
            } else if ((systolic >= 130 && systolic < 140) || (diastolic >= 80 && diastolic < 90)) {
                category = "Stage 1 Hypertension";
                risk = hasDiabetes ? "High" : "Moderate-High";
                recommendations = "Consider medication, lifestyle changes essential";
            } else {
                category = "Stage 2 Hypertension";
                risk = "High";
                recommendations = "Medication and lifestyle changes needed";
            }
            
            // Adjust risk based on age and kidney disease
            let kidneyRisk = "Standard";
            if (systolic > 140 || diastolic > 90) {
                kidneyRisk = "Increased risk of kidney damage";
            }
            
            const resultDiv = document.getElementById('bp-result');
            resultDiv.innerHTML = `
                <div class="result-card">
                    <div class="result-value">${systolic}/${diastolic} mmHg</div>
                    <div class="result-interpretation">${category}</div>
                    <div class="result-stage" style="background: ${risk === 'High' ? '#fecaca' : risk === 'Moderate-High' ? '#fed7aa' : '#dcfce7'}; color: ${risk === 'High' ? '#991b1b' : risk === 'Moderate-High' ? '#9a3412' : '#166534'};">
                        ${risk} CVD Risk
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: #6b7280;">
                        <strong>Kidney Risk:</strong> ${kidneyRisk}<br>
                        <strong>Recommendations:</strong> ${recommendations}
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        });

        // Protein Intake Calculator
        document.getElementById('protein-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const weight = parseFloat(document.getElementById('weight').value);
            const stage = document.getElementById('ckd-stage').value;
            const activity = document.getElementById('activity').value;
            
            let baseProtein;
            switch(stage) {
                case '1':
                case '2':
                    baseProtein = 0.8;
                    break;
                case '3a':
                case '3b':
                    baseProtein = 0.6;
                    break;
                case '4':
                    baseProtein = 0.6;
                    break;
                case '5':
                    baseProtein = 0.6;
                    break;
                default:
                    baseProtein = 0.8;
            }
            
            // Adjust for activity
            let multiplier = 1;
            switch(activity) {
                case 'light':
                    multiplier = 1.1;
                    break;
                case 'moderate':
                    multiplier = 1.2;
                    break;
                case 'high':
                    multiplier = 1.3;
                    break;
            }
            
            const dailyProtein = (baseProtein * weight * multiplier).toFixed(1);
            const perMealProtein = (dailyProtein / 3).toFixed(1);
            
            const resultDiv = document.getElementById('protein-result');
            resultDiv.innerHTML = `
                <div class="result-card">
                    <div class="result-value">${dailyProtein}g/day</div>
                    <div class="result-interpretation">Recommended Daily Protein</div>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: #6b7280;">
                        <strong>Per meal:</strong> ~${perMealProtein}g<br>
                        <strong>Per kg body weight:</strong> ${(baseProtein * multiplier).toFixed(1)}g/kg<br>
                        <strong>Stage ${stage} + ${activity} activity</strong>
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        });

        // Fluid Balance Calculator
        document.getElementById('fluid-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const urineOutput = parseInt(document.getElementById('urine-output').value);
            const weight = parseFloat(document.getElementById('fluid-weight').value);
            const dialysisType = document.getElementById('dialysis').value;
            const climate = document.getElementById('climate').value;
            
            let fluidAllowance;
            
            if (dialysisType === 'no') {
                // Non-dialysis CKD
                fluidAllowance = urineOutput + 500; // Urine output + 500ml for insensible losses
            } else if (dialysisType === 'hd') {
                // Hemodialysis
                fluidAllowance = urineOutput + 750; // More restrictive
            } else {
                // Peritoneal dialysis
                fluidAllowance = urineOutput + 1000; // Slightly more liberal
            }
            
            // Adjust for climate
            if (climate === 'hot') {
                fluidAllowance += 250;
            } else if (climate === 'cold') {
                fluidAllowance -= 100;
            }
            
            const fluidPerKg = (fluidAllowance / weight).toFixed(1);
            
            const resultDiv = document.getElementById('fluid-result');
            resultDiv.innerHTML = `
                <div class="result-card">
                    <div class="result-value">${fluidAllowance}mL/day</div>
                    <div class="result-interpretation">Recommended Daily Fluid Intake</div>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: #6b7280;">
                        <strong>Per kg body weight:</strong> ${fluidPerKg}mL/kg<br>
                        <strong>Based on urine output:</strong> ${urineOutput}mL<br>
                        <strong>Treatment:</strong> ${dialysisType === 'no' ? 'Conservative' : dialysisType.toUpperCase()}
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: #fef3c7; border-radius: 8px; font-size: 0.85rem;">
                        <strong>Tip:</strong> Distribute fluid intake throughout the day. Include all liquids (water, tea, soup, etc.)
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        });

        // Medication Dosing Calculator
        document.getElementById('med-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const egfr = parseFloat(document.getElementById('med-egfr').value);
            const medication = document.getElementById('medication').value;
            const standardDose = parseFloat(document.getElementById('standard-dose').value);
            
            let adjustedDose, frequency, notes;
            
            switch(medication) {
                case 'metformin':
                    if (egfr >= 45) {
                        adjustedDose = standardDose;
                        frequency = "Standard dosing";
                        notes = "Monitor kidney function every 3-6 months";
                    } else if (egfr >= 30) {
                        adjustedDose = standardDose * 0.5;
                        frequency = "Reduce dose by 50%";
                        notes = "Consider discontinuation if eGFR continues to decline";
                    } else {
                        adjustedDose = 0;
                        frequency = "CONTRAINDICATED";
                        notes = "Do not use when eGFR <30";
                    }
                    break;
                    
                case 'gabapentin':
                    if (egfr >= 60) {
                        adjustedDose = standardDose;
                        frequency = "Every 8 hours";
                    } else if (egfr >= 30) {
                        adjustedDose = standardDose * 0.5;
                        frequency = "Every 12 hours";
                    } else if (egfr >= 15) {
                        adjustedDose = standardDose * 0.25;
                        frequency = "Every 24 hours";
                    } else {
                        adjustedDose = standardDose * 0.125;
                        frequency = "Every 48 hours";
                    }
                    notes = "Titrate slowly in kidney disease";
                    break;
                    
                default:
                    adjustedDose = standardDose;
                    frequency = "Consult prescribing information";
                    notes = "Individual adjustment may be needed";
            }
            
            const resultDiv = document.getElementById('med-result');
            resultDiv.innerHTML = `
                <div class="result-card">
                    <div class="result-value">${adjustedDose.toFixed(1)}mg</div>
                    <div class="result-interpretation">Adjusted Dose for eGFR ${egfr}</div>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: #6b7280;">
                        <strong>Frequency:</strong> ${frequency}<br>
                        <strong>Standard dose:</strong> ${standardDose}mg<br>
                        <strong>Notes:</strong> ${notes}
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: #fecaca; border-radius: 8px; font-size: 0.85rem; color: #991b1b;">
                        <strong>‚ö†Ô∏è Always verify with your physician before making dose adjustments</strong>
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        });

        // Health Progress Tracker
        let healthData = {
            egfr: [],
            creatinine: [],
            'blood-pressure': [],
            weight: []
        };

        let progressChart = null;

        function addDataPoint() {
            const metric = document.getElementById('track-metric').value;
            const value = parseFloat(document.getElementById('track-value').value);
            
            if (value) {
                const today = new Date().toISOString().split('T')[0];
                healthData[metric].push({
                    date: today,
                    value: value
                });
                
                document.getElementById('track-value').value = '';
                updateProgressChart();
            }
        }

        function clearData() {
            const metric = document.getElementById('track-metric').value;
            healthData[metric] = [];
            updateProgressChart();
        }

        function updateProgressChart() {
            const metric = document.getElementById('track-metric').value;
            const data = healthData[metric];
            
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            if (progressChart) {
                progressChart.destroy();
            }
            
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [{
                        label: metric.charAt(0).toUpperCase() + metric.slice(1),
                        data: data.map(d => d.value),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${metric.charAt(0).toUpperCase() + metric.slice(1)} Progress Over Time`
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        // Initialize progress chart
        document.addEventListener('DOMContentLoaded', function() {
            updateProgressChart();
            
            document.getElementById('track-metric').addEventListener('change', updateProgressChart);
        });
    </script>
</body>
</html>
